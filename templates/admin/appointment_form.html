{% extends "partials/layout.html" %}

{% block header %}
{% include "partials/header.html" %}
{% endblock header %}

{% block slider %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
button.btn.btn-primary,
.btn-primary {
  background-color: #0d6efd !important;
  border-color: #0d6efd !important;
  color: #fff !important;
  padding: 0.375rem 0.75rem;
  font-size: 0.875rem;
  width: auto;
  max-width: 200px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  box-shadow: none !important;
  filter: none !important;
  transform: none !important;
  transition: none !important; /* disable any hover transition */
}

.btn-green:hover {
        background-color: #0d6efd;
        color: #fff;
        border-color: #0d6efd;
    }
</style>

<div class="container d-flex justify-content-center align-items-center min-vh-100">
  <div class="form-container w-100">
    <h2 class="form-title">{% if appointment %}Update Appointment{% else %}Book Appointment Now{% endif %}</h2>
    {% if request.user.is_authenticated%}
    <div class="d-flex gap-2 mt-4">
  <!-- Button-like link -->
  <a href="{% url 'appointment' %}" class="btn-green">Appointment Lists</a>
</div>
{% endif %}

    <form action="{% if appointment %}{% url 'update_appointment' appointment.id %}{% else %}{% url 'add_appointment' %}{% endif %}" method="post" onsubmit="return validateMobileNumber()">
      {% csrf_token %}

      <div class="row">
        <div class="col-md-6 form-group">
          <label class="form-label">Name</label>
          <input type="text" class="form-control" name="name" value="{% if form_data.name %}{{ form_data.name }}{% elif appointment %}{{ appointment.name }}{% endif %}" required>
        </div>
        <div class="col-md-6 form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" name="email" value="{% if form_data.email %}{{ form_data.email }}{% elif appointment %}{{ appointment.email }}{% endif %}" required>
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-md-6 form-group">
          <label class="form-label">Mobile Number</label>
          <input type="text" class="form-control" name="mobile_number" maxlength="10" pattern="\d{10}" title="Enter exactly 10 digits" oninput="this.value=this.value.replace(/[^0-9]/g,'')" value="{% if form_data.mobile_number %}{{ form_data.mobile_number }}{% elif appointment %}{{ appointment.mobile_number }}{% endif %}" required>
        </div>

        <div class="col-md-6 form-group">
          <label class="form-label">Selected Service</label>
          <select class="form-control {% if service_error %}is-invalid{% endif %}" name="selected_service" required>
            <option value="">Select a Service</option>
            {% for service in services %}
              <option value="{{ service.id }}"
                {% if form_data.selected_service %}
                  {% if service.id|stringformat:"s" == form_data.selected_service|stringformat:"s" %}selected{% endif %}
                {% elif appointment and service.id == appointment.selected_service.id %}
                  selected
                {% endif %}
              >{{ service.title }}</option>
            {% endfor %}
          </select>
          {% if service_error %}
            <div class="invalid-feedback d-block">
              {{ service_error }}
            </div>
          {% endif %}
        </div>
      </div>

      <div class="form-group mt-3">
        <label class="form-label">Date</label>
        <input type="date" class="form-control" name="date" value="{% if form_data.date %}{{ form_data.date }}{% elif appointment %}{{ appointment.date|date:'Y-m-d' }}{% endif %}" required>
      </div>

      <div class="form-group mt-3">
        <label class="form-label">Message</label>
        <textarea class="form-control" name="message">{% if form_data.message %}{{ form_data.message }}{% elif appointment %}{{ appointment.message }}{% endif %}</textarea>
      </div>

      <div class="d-flex gap-2 mt-4">
       <!-- Button -->
      <div class="d-flex gap-2 mt-4">
        <!-- Button with same size styling but no icon -->
         <button type="submit" class="btn-green">
          {% if appointment %}Update{% else %}Book Appointment{% endif %}
        </button>

        {% if appointment %}
        <a href="{% url 'delete_appointment' appointment.id %}" class="btn btn-danger w-100">Delete</a>
        {% endif %}
      </div>


      {% if error_message %}
        <div class="alert alert-danger mt-3" role="alert">
          {{ error_message }}
        </div>
      {% endif %}
    </form>
  </div>
</div>

<script>
  function validateMobileNumber() {
    const mobileInput = document.querySelector('input[name="mobile_number"]');
    const mobileValue = mobileInput.value.trim();
    const regex = /^\d{10}$/;

    if (!regex.test(mobileValue)) {
      alert('Mobile number must be exactly 10 digits and contain only numbers.');
      mobileInput.focus();
      return false;
    }
    return true;
  }
</script>

{% endblock slider %}
